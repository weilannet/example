{"version":3,"sources":["handler.js"],"names":[],"mappings":"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","file":"handler-compiled.js","sourcesContent":["\"use strict\";\r\n\r\nconst fs = require('fs');\r\nconst _ = require('underscore');\r\n\r\n\r\nconst musicList = [\r\n  {\r\n    id: '1',\r\n    name: '演员',\r\n    singer: '薛之谦',\r\n    isHightRate: true\r\n  },\r\n  {\r\n    id: '2',\r\n    name: '丑八怪',\r\n    singer: '薛之谦',\r\n    isHightRate: false\r\n  },\r\n  {\r\n    id: '3',\r\n    name: 'Fade',\r\n    singer: 'Alan Walker',\r\n    isHightRate: true\r\n  },\r\n  {\r\n    id: '4',\r\n    name: '想着你的感觉',\r\n    singer: '容祖儿',\r\n    isHightRate: true\r\n  },\r\n  {\r\n    id: '5',\r\n    name: '叽咕叽咕',\r\n    singer: '徐佳莹',\r\n    isHightRate: false\r\n  }\r\n];\r\n\r\n// showIndex  showAdd showEdit\r\n// 读取文件，模板编译、注入数据\r\n\r\n// res.render('index',{})\r\n\r\n\r\nexports.showIndex = function (req, res) {\r\n  res.render('index',{\r\n    title:'首页'\r\n  });\r\n};\r\n\r\nexports.getMusicList = function (req, res) {\r\n  res.writeHead(200, {\r\n    'Content-Type': 'text/plain; charset=utf-8'\r\n  });\r\n   \r\n  res.end(JSON.stringify({\r\n    musicList: musicList\r\n  }));\r\n};\r\n\r\nexports.showAdd = function (req, res) {\r\n  fs.readFile('./add.html', 'utf8', function (err, data) {\r\n    if (err) {\r\n      return res.end(err.message);\r\n    }\r\n    res.writeHead(200, {\r\n      'Content-Type': 'text/html'\r\n    });\r\n\r\n    res.end(data);\r\n  });\r\n};\r\n\r\nexports.doAdd = function (req, res) {\r\n  let id = req.body.id;\r\n  let name = req.body.name;\r\n  let singer = req.body.singer;\r\n  let isHightRate = req.body.isHightRate;\r\n\r\n  let musicInfo = musicList.find(m => m.id === id);\r\n\r\n  if (musicInfo) {\r\n    return res.end('music is already exists');\r\n  }\r\n\r\n  isHightRate = isHightRate === '1' ? true : false;\r\n\r\n  musicList.push({\r\n    id,\r\n    name,\r\n    singer,\r\n    isHightRate\r\n  });\r\n\r\n  res.writeHead(302, {\r\n    'Location': 'http://127.0.0.1:3000/'\r\n  });\r\n\r\n  res.end();\r\n};\r\n\r\nexports.doRemove = function (req, res) {\r\n  let index = musicList.findIndex(m => m.id === req.params.mid);\r\n  try {\r\n    musicList.splice(index, 1);\r\n    res.end(JSON.stringify({\r\n      code: '1',\r\n      msg: 'ok'\r\n    }));\r\n  } catch (e) {\r\n    res.end(JSON.stringify({\r\n      code: '0',\r\n      msg: e.message\r\n    }));\r\n  }\r\n};\r\n\r\nexports.showEdit = function (req, res) {\r\n  // 根据音乐信息id找到该项\r\n  let musicInfo = musicList.find(m => m.id === req.params.mid);\r\n\r\n  // 如果用户要编辑的\r\n  if (!musicInfo) {\r\n    return res.end('music is not exists');\r\n  }\r\n  res.render('edit', {musicInfo:musicInfo} );\r\n};\r\n\r\nexports.doEdit = function (req, res) {\r\n  let name = req.body.name;\r\n  let singer = req.body.singer;\r\n  let isHightRate = req.body.isHightRate;\r\n\r\n  // 你要编辑谁？\r\n  // 根据id查找数组中的索引\r\n  let index = musicList.findIndex(m => m.id === req.params.mid);\r\n\r\n  musicList[index].name = name;\r\n  musicList[index].singer = singer;\r\n  musicList[index].isHightRate = isHightRate === '1' ? true : false;\r\n\r\n  // 修改完之后，直接跳转到首页\r\n  // 301 重定向   永久重定向\r\n  // 302 重定向   临时重定向\r\n\r\n  res.writeHead(302, {\r\n    'Location': 'http://127.0.0.1:3000/'\r\n  });\r\n\r\n  // 记住，哪怕只写了响应头，也一定要end\r\n  res.end();\r\n};\r\n"]}